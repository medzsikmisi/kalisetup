#!/bin/bash

BLUE='\033[34m'
NC='\033[0m' # No Color

ENV_MODE=0

while getopts "i:h:e" opt; do
  case $opt in
    i) IP="$OPTARG" ;;
    h) HOSTNAME="$OPTARG" ;;
    e) ENV_MODE=1 ;;
    *) echo "Usage: $0 [-e] [-i ip] [-h hostname]"; exit 1 ;;
  esac
done

if [ $ENV_MODE -eq 1 ]; then
  if [ ! -f .env ]; then
    echo ".env file not found in the current directory!"
    exit 1
  fi

  set -a
  # shellcheck disable=SC1091
  . ./.env
  set +a

fi

if [ -z "$IP" ] || [ -z "$HOSTNAME" ]; then
  echo "Both -i (ip) and -h (hostname) are required, or provide them in the .env file with -e."
  exit 1
fi

# Remove lines starting with 10.10 or 192.168
sudo sed -i.bak -E '/^(10\.10|192\.168)/d' /etc/hosts

# Append the new entry with a tab between IP and hostname
printf "%s\t%s\n" "$IP" "$HOSTNAME" | sudo tee -a /etc/hosts > /dev/null
echo -e "${BLUE}The IP '$IP' has been appended to the hostfile as '$HOSTNAME'${NC}"
